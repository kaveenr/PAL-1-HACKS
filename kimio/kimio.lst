ca65 V2.18 - N/A
Main file   : kimio.s
Current file: kimio.s

000000r 1               ; (2022) Kaveen Rodrigo / ukr.lk
000000r 1               
000000r 1               	.setcpu "6502"
000000r 1               
000000r 1               ; Reference To ROM Routines In The KIM-1
000000r 1               
000000r 1               SCANDS 	=	$1f1f
000000r 1               GETKEY 	= 	$1f6a
000000r 1               
000000r 1               ; Reference to SCANDS values
000000r 1               
000000r 1               dig12	=	$f9
000000r 1               dig34	=	$fa
000000r 1               dig56	=	$fb
000000r 1               
000000r 1               ;		Zero page variables
000000r 1               selkey	=	$00
000000r 1               
000000r 1               ; 		Start program at free RAM.
000000r 1               		.org 	$0200
000200  1               
000200  1  D8           init:	cld					; Clear Decimal
000201  1  A9 00        		lda #$00			; Initialize SCANDS Values
000203  1  85 F9        		sta dig12
000205  1  85 FA        		sta dig34
000207  1  85 FB        		sta dig56
000209  1               
000209  1  20 1F 1F     loop:	jsr SCANDS
00020C  1  20 6A 1F     		jsr GETKEY
00020F  1               
00020F  1  C9 15        		cmp #$15			; Handle no key press
000211  1  F0 F6        		beq loop
000213  1               
000213  1  85 00        		sta selkey			; Save Selected Valid Key
000215  1               
000215  1  20 1F 1F     bounce:	jsr SCANDS
000218  1  20 6A 1F     		jsr GETKEY			; Wait till key is released
00021B  1  C5 00        		cmp selkey
00021D  1  F0 F6        		beq bounce
00021F  1               
00021F  1  A5 00        		lda selkey
000221  1               
000221  1  C9 10        		cmp #$10			; AD Key is pressed
000223  1  F0 0D        		beq a_val
000225  1               
000225  1  C9 11        		cmp #$11			; DA Key is pressed
000227  1  F0 19        		beq s_val
000229  1               
000229  1  C9 14        		cmp #$14			; PC Key is pressed
00022B  1  F0 25        		beq c_val
00022D  1               
00022D  1  85 F9        		sta dig12			; Store valid key press
00022F  1               
00022F  1  4C 09 02     		jmp loop
000232  1               
000232  1  18           a_val:	clc					; Clear carry flag
000233  1  A5 FA        		lda dig34			; Load current low
000235  1  65 F9        		adc dig12			; Add Selected number
000237  1  85 FA        		sta dig34			; Store low
000239  1               
000239  1  A5 FB        		lda dig56			; Load current high
00023B  1  69 00        		adc #$00			; Add 0 with carry
00023D  1  85 FB        		sta dig56			; Store high
00023F  1  4C 09 02     		jmp loop
000242  1               
000242  1  38           s_val:	sec
000243  1  A5 FA        		lda dig34			; Load current low
000245  1  E5 F9        		sbc dig12			; Deduct Selected number
000247  1  85 FA        		sta dig34			; Store low
000249  1               
000249  1  A5 FB        		lda dig56			; Load current high
00024B  1  E9 00        		sbc #$00			; Deduct 0 with carry
00024D  1  85 FB        		sta dig56			; Store high
00024F  1  4C 09 02     		jmp loop
000252  1               
000252  1               c_val:
000252  1  A9 00        		lda #0
000254  1  85 FA        		sta dig34
000256  1  85 FB        		sta dig56
000258  1  4C 09 02     		jmp loop
000258  1               
